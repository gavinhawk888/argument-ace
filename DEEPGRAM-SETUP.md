# Deepgram 语音识别配置指南

本项目已从腾讯云 ASR 迁移到 Deepgram API，支持中英文混合语音识别。

## 🚀 快速配置

### 1. 获取 Deepgram API 密钥

1. 访问 [Deepgram Console](https://console.deepgram.com/)
2. 注册账户并登录
3. 创建新项目或使用现有项目
4. 生成 API 密钥

### 2. 配置环境变量

在项目根目录创建 `.env.local` 文件（如果不存在）：

```bash
# Deepgram API Configuration
DEEPGRAM_API_KEY=your_deepgram_api_key_here

# OpenAI API Configuration (用于AI回应生成)
OPENAI_API_KEY=your_openai_api_key_here
```

⚠️ **重要**: 请将 `your_deepgram_api_key_here` 替换为您的真实 API 密钥

### 3. 重启开发服务器

```bash
npm run dev
```

## 🌟 功能特性

### 多语言混合识别 (Nova-3 模型)

- ✅ **中英文混合**: 支持在同一句话中混合使用中文和英文
- ✅ **单词级语言检测**: 每个单词都有对应的语言标签
- ✅ **高精度识别**: 使用 Deepgram 最新的 Nova-3 模型
- ✅ **实时处理**: 快速响应和处理
- ✅ **标点符号**: 自动添加标点符号
- ✅ **智能格式化**: 自动格式化数字、日期等

### 技术规格

- **模型**: Nova-3
- **语言**: `multi` (多语言代码切换)
- **端点**: 100ms (优化用于代码切换)
- **音频格式**: WebM, MP4, WAV
- **采样率**: 44.1kHz (自动适配)
- **声道**: 单声道/立体声均支持

## 🧪 测试

### 1. 基础测试

运行现有的测试文件：

```bash
# 使用 TypeScript 测试
npm run test:wav

# 或者直接运行
npx tsx test-deepgram.ts
```

### 2. 中英文混合测试示例

尝试说以下内容来测试混合语言识别：

- "我今天要去 meeting"
- "Please help me 翻译这个句子"
- "这个 project 非常 interesting"
- "Let's go to 北京"

## 🔧 故障排除

### API 密钥问题

如果遇到认证错误：

1. 检查 `.env.local` 文件是否正确配置
2. 确认 API 密钥没有多余的空格
3. 验证 API 密钥是否有效且未过期
4. 检查账户余额是否充足

### 音频问题

如果识别效果不佳：

1. 确保麦克风权限已授予
2. 检查音频质量和音量
3. 避免背景噪音
4. 说话清晰，语速适中

### 网络问题

如果请求超时：

1. 检查网络连接
2. 验证防火墙设置
3. 考虑使用代理（如果在受限网络环境中）

## 📊 性能对比

| 特性 | 腾讯云 ASR | Deepgram Nova-3 |
|------|-----------|-----------------|
| 中英文混合 | ⚠️ 有限支持 | ✅ 原生支持 |
| 单词级语言标签 | ❌ 无 | ✅ 有 |
| 处理速度 | 慢 | 快 |
| 准确度 | 中等 | 高 |
| API 稳定性 | 一般 | 优秀 |
| 文档质量 | 一般 | 优秀 |

## 🎯 最佳实践

1. **音频质量**: 使用高质量麦克风，避免回音
2. **说话方式**: 清晰发音，适当停顿
3. **混合语言**: 自然切换，不要刻意停顿
4. **长句处理**: 长句可能需要分段识别
5. **错误处理**: 应用已内置重试机制

## 📈 后续优化

考虑的改进方向：

1. **流式识别**: 实现实时流式语音识别
2. **自定义词汇**: 添加专业术语词典
3. **说话人识别**: 多人对话场景的支持
4. **语音活动检测**: 智能静音检测

## 🆘 获取帮助

如果遇到问题：

1. 查看浏览器控制台的错误信息
2. 检查 API 响应和日志
3. 参考 [Deepgram 文档](https://developers.deepgram.com/docs/)
4. 联系技术支持 